{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/lecture/pm-incubator-forge/sookyungyou/google_analytics/app/documents/list/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport Link from \"next/link\";\r\nimport { useEffect, useState } from \"react\";\r\n\r\ninterface DocumentMeta {\r\n    id: number;\r\n    file_name: string;\r\n    s3_key: string;\r\n    uploader_id: number;\r\n}\r\n\r\ninterface AnalyzeResultType {\r\n    parsed_text: string;\r\n    summaries: {\r\n        bullet: string;\r\n        abstract: string;\r\n        casual: string;\r\n        final: string;\r\n    };\r\n    answer: string;\r\n}\r\n\r\nexport default function DocumentListPage() {\r\n    const [documents, setDocuments] = useState<DocumentMeta[]>([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState(\"\");\r\n    const [analyzeResults, setAnalyzeResults] = useState<Record<number, AnalyzeResultType>>({});\r\n    const [analyzingId, setAnalyzingId] = useState<number | null>(null);\r\n\r\n    const fetchDocuments = async () => {\r\n        setLoading(true);\r\n        setError(\"\");\r\n        try {\r\n            const res = await fetch(`${process.env.NEXT_PUBLIC_API_BASE_URL}/documents/list`, {\r\n                credentials: \"include\",\r\n            });\r\n            const data = await res.json();\r\n            if (!res.ok) throw new Error(data.detail || \"문서 목록 불러오기 실패\");\r\n            setDocuments(data);\r\n        } catch (e: any) {\r\n            setError(e.message);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleAnalyze = async (doc: DocumentMeta) => {\r\n        const s3Url = `https://s3-eddi-lsh-bucket.s3.ap-northeast-2.amazonaws.com/${doc.s3_key}`;\r\n        setAnalyzingId(doc.id);\r\n        try {\r\n            const res = await fetch(`${process.env.NEXT_PUBLIC_API_BASE_URL}/documents-multi-agents/analyze`, {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({\r\n                    doc_id: doc.id,\r\n                    doc_url: s3Url,\r\n                    question: \"Summarize the content\",\r\n                }),\r\n                credentials: \"include\",\r\n            });\r\n\r\n            const data = await res.json();\r\n            if (!res.ok) throw new Error(data.detail || \"분석 실패\");\r\n\r\n            setAnalyzeResults(prev => ({\r\n                ...prev,\r\n                [doc.id]: data,\r\n            }));\r\n        } catch (e: any) {\r\n            alert(`분석 실패: ${e.message}`);\r\n        } finally {\r\n            setAnalyzingId(null);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchDocuments();\r\n    }, []);\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gray-100 p-8\">\r\n            <h1 className=\"text-2xl font-bold text-gray-900 mb-6 text-center\">문서 리스트</h1>\r\n\r\n            <div className=\"text-center mb-6\">\r\n                <Link\r\n                    href=\"/documents/register\"\r\n                    className=\"bg-blue-600 px-4 py-2 rounded text-white hover:bg-blue-700\"\r\n                >\r\n                    문서 업로드\r\n                </Link>\r\n            </div>\r\n\r\n            {loading && <p className=\"text-center text-gray-700\">불러오는 중...</p>}\r\n            {error && <p className=\"text-center text-red-600 font-medium\">{error}</p>}\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                {documents.map((doc) => {\r\n                    const s3Url = `https://s3-eddi-lsh-bucket.s3.ap-northeast-2.amazonaws.com/${doc.s3_key}`;\r\n                    const result = analyzeResults[doc.id];\r\n                    const isAnalyzing = analyzingId === doc.id;\r\n\r\n                    return (\r\n                        <div key={doc.id} className=\"bg-white shadow rounded-lg p-4 flex flex-col\">\r\n                            <p className=\"font-medium text-gray-900\">{doc.file_name}</p>\r\n                            <a\r\n                                href={s3Url}\r\n                                target=\"_blank\"\r\n                                rel=\"noopener noreferrer\"\r\n                                className=\"mt-2 text-blue-600 hover:underline\"\r\n                            >\r\n                                열기\r\n                            </a>\r\n\r\n                            <button\r\n                                onClick={() => handleAnalyze(doc)}\r\n                                disabled={isAnalyzing}\r\n                                className={`mt-2 px-3 py-1 rounded text-white ${\r\n                                    isAnalyzing ? \"bg-gray-400 cursor-not-allowed\" : \"bg-green-500 hover:bg-green-600\"\r\n                                }`}\r\n                            >\r\n                                {isAnalyzing ? \"분석 중...\" : \"분석\"}\r\n                            </button>\r\n\r\n                            <p className=\"mt-auto text-gray-500 text-sm\">Uploader ID: {doc.uploader_id}</p>\r\n\r\n                            {result && (\r\n                                <div className=\"mt-4 bg-gray-50 border border-gray-300 p-3 rounded shadow-inner text-gray-800\">\r\n                                    <h3 className=\"font-semibold mb-1 text-gray-900\">Parsed Text</h3>\r\n                                    <pre className=\"whitespace-pre-wrap text-sm\">{result.parsed_text}</pre>\r\n\r\n                                    <h3 className=\"font-semibold mt-3 mb-1 text-gray-900\">Summaries</h3>\r\n                                    <ul className=\"list-disc list-inside text-sm\">\r\n                                        <li><strong>Bullet:</strong> {result.summaries.bullet}</li>\r\n                                        <li><strong>Abstract:</strong> {result.summaries.abstract}</li>\r\n                                        <li><strong>Casual:</strong> {result.summaries.casual}</li>\r\n                                        <li><strong>Final:</strong> {result.summaries.final}</li>\r\n                                    </ul>\r\n\r\n                                    <h3 className=\"font-semibold mt-3 mb-1 text-gray-900\">Answer</h3>\r\n                                    <p className=\"text-sm\">{result.answer}</p>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    );\r\n                })}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}